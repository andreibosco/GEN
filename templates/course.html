{% extends 'base_course.html' %}

{% load humanize %}
{% load gravatar %}
{% load countscore %}

{% block title %}OPEN2 - {{ course.code }} - {{course.name}} {% endblock title %}

{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
  <li class="breadcrumb-item active">{{ course.code }}</li>
{% endblock breadcrumb %}

{% block content_tabs %}
  <li class="nav-item">
    <a class="nav-link active" href="#">Info</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'course_forums' course.pk %}">Forums</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'list_videos' course.pk %}">Videos</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'list_pdfs' course.pk %}">PDFs</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'list_quiz' course.pk %}">Quizzes</a>
  </li>
{% endblock content_tabs %}

{% block content %}
  <div class="card mb-3">
    <h5 class="card-header bg-light">{{ course.name }}</h5>
    <div class="card-body pb-0">
      <table class="table table-hover">
        <tbody>
          <tr>
            <th scope="row" style="width:12%">Code</th>
            <td>{{course.code}}</td>
          </tr>
          <tr>
            <th scope="row" style="width:12%">Starting date</th>
            <td>{{course.start_date}}<br /><small>{{ course.start_date|naturaltime}}</small></td>
          </tr>
          <tr>
            <th scope="row" style="width:12%">Ending date</th>
            <td>{{course.end_date}}<br /><small>{{ course.end_date|naturaltime}}</small></td>
          </tr>
          <tr>
            <th scope="row" style="width:12%">Description</th>
            <td>{{course.description }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card-deck">
    <div class="card">
      <h5 class="card-header bg-light"><i class="fas fa-heart pr-1"></i> Scoreboard</h5>
      <div class="card-body pb-0">
        <table class="table table-hover">
          <tbody>
            <tr>
              <td>Forums</td>
              <td class="text-center">{% countscore_course user.id course.pk "forum" %}</td>
            </tr>
            <tr>
              <td>Comments</td>
              <td class="text-center">{% countscore_course user.id course.pk "comment" %}</td>
            </tr>
            <tr>
              <td>Quizzes</td>
              <td class="text-center">{% countscore_course user.id course.pk "quiz" %}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h5 class="card-header bg-light"><i class="fas fa-award pr-1"></i> Leaderboard</h5>
      <div class="card-body pb-0">
        <table class="table table-hover">
          <tbody>
            <tr>
              <td>Forum likes</td>
              <td>#{% rank_course user.id course.pk "forum" %}</td>
            </tr>
            <tr>
              <td>Comments</td>
              <td>#X</td>
            </tr>
            <tr>
              <td>Quiz</td>
              <td>#X</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h5 class="card-header bg-light"><i class="fas fa-check-square  pr-1"></i>  Course Progress</h5>
      <div class="card-body pb-0">
        <ul class="list-unstyled">
          <li>Forums participation:
            {{forums_progress.current}} / {{forums_progress.max}}

            {% if forums_progress.max > 0 %}

              {% widthratio forums_progress.current forums_progress.max 100 as forums_progress_percent %}
              <div class="progress mt-1 mb-3" data-toggle="tooltip" data-placement="top" title="{{forums_progress_percent}}%">
                <div class="progress-bar {% if forums_progress_percent == '100' %}bg-success{% endif %}" role="progressbar" style="width: {{forums_progress_percent}}%;" aria-valuenow="{{forums_progress_percent}}" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            {% else %}
              <div class="progress mt-1 mb-3" data-toggle="tooltip" data-placement="top" title="This course has no forums">
                <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            {% endif %}
          </li>

          <li>Quizzes answered:
            {{quizzes_progress.current}} / {{quizzes_progress.max}}

            {% if quizzes_progress.max > 0 %}
              {% widthratio quizzes_progress.current quizzes_progress.max 100 as quizzes_progress_percent %}
              <div class="progress mt-1 mb-3" data-toggle="tooltip" data-placement="top" title="{{quizzes_progress_percent}}%">
                <div class="progress-bar {% if quizzes_progress_percent == '100' %}bg-success{% else %}bg-warning{% endif %}" role="progressbar" style="width: {{quizzes_progress_percent}}%;" aria-valuenow="{{quizzes_progress_percent}}" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            {% else %}
              <div class="progress mt-1 mb-3" data-toggle="tooltip" data-placement="top" title="This course has no quizzes">
                <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            {% endif %}
          </li>
        </ul>
      </div>
    </div>
  </div>
{% endblock content %}
